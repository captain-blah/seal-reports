var SWIUtil;!function(i){function t(e){var t=tra[e];return t&&""!=t||(t=e),t}i.tr=t,i.tr2=function(e){return $("<div/>").html(t(e)).text()},i.Newguid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},i.GetReportName=function(e){return e.split(dirSeparator).pop().replace(".srex","")},i.GetDirectoryName=function(e){return e.substring(0,e.lastIndexOf(dirSeparator))},i.ShowMessage=function(t,a,o){setTimeout(function(){$waitDialog.modal("hide"),i.HideMessages();var e=$("<div class='alert' style='position:absolute; width:80%; z-index: 2000;margin-bottom:0;'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a><p>"+a+"</p></div>");e.css("top",($(window).height()-54).toString()+"px"),e.css("left",($(window).width()/10).toString()+"px"),e.addClass(t),$("body").append(e),0==o&&(o=15e3),0<o&&setTimeout(function(){e.alert("close")},o)},500)},i.HideMessages=function(){$(".alert").alert("close")},i.EnableButton=function(e,t){0<e.length&&"button"===e[0].type?t?e.addClass("active").removeClass("disabled"):e.removeClass("active").addClass("disabled"):t?e.removeAttr("disabled").removeProp("disabled").removeClass("disabled"):e.prop("disabled","true").addClass("disabled")},i.EnableLinkInput=function(e,t){t?e.removeAttr("disabled"):e.attr("disabled","true")},i.IsEnabled=function(e){return!(e.attr("disabled")||e.prop("disabled"))},i.ActivatePanel=function(e,t,a){a?(e.addClass("active"),t.show()):(e.removeClass("active"),t.hide())},i.ShowHideControl=function(e,t){t?e.show():e.hide()},i.GetOption=function(e,t,a,o){var i=$("<option>").attr("value",e).html(t||e);return o&&i.attr("data-icon",o),e==a&&i.attr("selected","true"),i},i.GetAnchorWithIcon=function(e,t,a,o){var i=$("<a/>").text(e);return i.html("<i class='"+o+"'></i> "+i.html()),t&&i.prop("id",t),a&&i.prop("type",a),i},i.UniqueName=function(e,t){for(var a=e,o=1;;){var i=!1;if($.each(t,function(e,t){t.name==a&&(i=!0)}),!i)break;a=e+o.toString(),o++}return a},i.GetAggregateName=function(e){return 1==e?i.tr2("Minimum of"):2==e?i.tr2("Maximum of"):3==e?i.tr2("Average of"):4==e?i.tr2("Count of"):""},i.FindBootstrapEnvironment=function(){var e=["xs","sm","md","lg"],t=$("<div>");t.appendTo($("body"));for(var a=e.length-1;0<=a;a--){var o=e[a];if(t.addClass("hidden-"+o),t.is(":hidden"))return t.remove(),o}},i.IsMobile=function(){return"xs"==i.FindBootstrapEnvironment()},i.InitNumericInput=function(){$(".numeric_input").keyup(function(){var e=this.value;$.isNumeric(e)||(this.value=this.value.slice(0,-1))})}}(SWIUtil=SWIUtil||{});var _server=WebApplicationName,_errorServer=SWIUtil.tr("Unexpected error on server")+": '"+_server+"'";function callbackHandler(e,t,a){e.error?a?a(e):(SWIUtil.ShowMessage("alert-danger",e.error,0),e.authenticated||location.reload(!0)):t&&t(e)}function failure(e,t,a){SWIUtil.ShowMessage("alert-danger",a+". "+_errorServer,0)}var $waitDialog,$editDialog,$folderTree,$loginModal,$outputPanel,$propertiesPanel,$elementDropDown,_gateway,_main,_editor,_dashboard,SWIGateway=function(){function e(){this._execForm=null}return e.prototype.getExecForm=function(e){return null==this._execForm&&(this._execForm=$('<form method="post" target="_blank"/>').appendTo("body")),this._execForm.find("input").remove(),this._execForm.attr("action",_server+e),this._execForm},e.prototype.GetVersions=function(t,a){$.post(_server+"SWIGetVersions",{}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.Login=function(e,t,a,o){$.post(_server+"SWILogin",{user:e,password:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.Logout=function(t,a){$.post(_server+"SWILogout").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetUserProfile=function(t,a){$.post(_server+"SWIGetUserProfile").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetCultures=function(t,a){$.post(_server+"SWIGetCultures").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SetUserProfile=function(e,t,a,o){$.post(_server+"SWISetUserProfile",{culture:e,defaultView:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.DeleteFiles=function(e,t,a){$.post(_server+"SWIDeleteFiles",{paths:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.MoveFile=function(e,t,a,o,i){$.post(_server+"SWIMoveFile",{source:e,destination:t,copy:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetRootFolders=function(t,a){$.post(_server+"SWIGetRootFolders",{}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetFolders=function(e,t,a){$.post(_server+"SWIGetFolders",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetFolderDetail=function(e,t,a){$.post(_server+"SWIGetFolderDetail",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.CreateFolder=function(e,t,a){$.post(_server+"SWICreateFolder",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.DeleteFolder=function(e,t,a){$.post(_server+"SWIDeleteFolder",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.RenameFolder=function(e,t,a,o){$.post(_server+"SWIRenameFolder",{source:e,destination:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.Search=function(e,t,a,o){$.post(_server+"SWISearch",{path:e,pattern:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.ExecuteReport=function(e,t,a,o){var i=this.getExecForm("SWExecuteReport");i.append($("<input />").attr("name","path").attr("value",e)),i.append($("<input />").attr("name","render").attr("value",JSON.stringify(t))),i.append($("<input />").attr("name","viewGUID").attr("value",a)),i.append($("<input />").attr("name","outputGUID").attr("value",o)),i.children("input").attr("type","hidden"),i.submit()},e.prototype.ExecuteReportDefinition=function(e,t,a,o){var i=this.getExecForm("SWExecuteReportDefinition");i.append($("<input />").attr("name","report").attr("value",e)),i.append($("<input />").attr("name","render").attr("value",JSON.stringify(t))),i.append($("<input />").attr("name","viewGUID").attr("value",a)),i.append($("<input />").attr("name","outputGUID").attr("value",o)),i.children("input").attr("type","hidden"),i.submit()},e.prototype.ViewFile=function(e){var t=this.getExecForm("SWViewFile");t.append($("<input />").attr("type","hidden").attr("name","path").attr("value",e)),t.submit()},e.prototype.GetReportDetail=function(e,t,a){$.post(_server+"SWIGetReportDetail",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.NewReportDefinition=function(e,t,a,o){$.post(_server+"SWINewReportDefinition",{path:e,sqlmodel:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetReportDefinition=function(e,t,a){$.post(_server+"SWIGetReportDefinition",{path:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SaveReportDefinition=function(e,t,a,o,i){$.post(_server+"SWISaveReportDefinition",{path:e,check:t,report:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.RefreshSQLModel=function(e,t,a){$.post(_server+"SWIRefreshSQLModel",{report:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetUserDashboards=function(t,a){$.post(_server+"SWIGetUserDashboards").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetDashboards=function(t,a){$.post(_server+"SWIGetDashboards").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetDashboardItems=function(e,t,a){$.post(_server+"SWIGetDashboardItems",{guid:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetDashboardItem=function(e,t,a,o){$.post(_server+"SWIGetDashboardItem",{guid:e,itemguid:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetWidgets=function(t,a){$.post(_server+"SWIGetWidgets").done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.GetDashboardResult=function(e,t,a,o,i){$.post(_server+"SWIGetDashboardResult",{guid:e,itemguid:t,force:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.AddDashboard=function(e,t,a){$.post(_server+"SWIAddDashboard",{guids:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.RemoveDashboard=function(e,t,a){$.post(_server+"SWIRemoveDashboard",{guid:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.CreateDashboard=function(e,t,a,o){$.post(_server+"SWICreateDashboard",{name:e,path:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.DeleteDashboard=function(e,t,a){$.post(_server+"SWIDeleteDashboard",{guid:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.MoveDashboard=function(e,t,a,o,i,n){$.post(_server+"SWIMoveDashboard",{guid:e,name:t,path:a,copy:o}).done(function(e){callbackHandler(e,i,n)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.AddDashboardItems=function(e,t,a,o,i){$.post(_server+"SWIAddDashboardItems",{guid:e,widgetguids:t,group:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SaveDashboardItem=function(e,t,a,o,i,n,r,l,d,s,c,p){$.post(_server+"SWISaveDashboardItem",{guid:e,itemguid:t,name:a,groupname:o,color:i,icon:n,width:r,height:l,refresh:d,dynamic:s}).done(function(e){callbackHandler(e,c,p)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.UpdateDashboardItemsGroupName=function(e,t,a,o,i){$.post(_server+"SWIUpdateDashboardItemsGroupName",{guid:e,oldname:t,newname:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.DeleteDashboardItem=function(e,t,a,o){$.post(_server+"SWIDeleteDashboardItem",{guid:e,itemguid:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SwapDashboardOrder=function(e,t,a,o){$.post(_server+"SWISwapDashboardOrder",{guid1:e,guid2:t}).done(function(e){callbackHandler(e,a,o)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SwapDashboardGroupOrder=function(e,t,a,o,i){$.post(_server+"SWISwapDashboardGroupOrder",{guid:e,source:t,destination:a}).done(function(e){callbackHandler(e,o,i)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SetLastDashboard=function(e,t,a){$.post(_server+"SWISetLastDashboard",{guid:e}).done(function(e){callbackHandler(e,t,a)}).fail(function(e,t,a){failure(e,t,a)})},e.prototype.SaveDashboardItemsOrder=function(e,t,a,o,i,n){$.post(_server+"SWISaveDashboardItemsOrder",{guid:e,orders:t,itemguid:a,groupname:o}).done(function(e){callbackHandler(e,i,n)}).fail(function(e,t,a){failure(e,t,a)})},e}();$(document).ready(function(){_gateway=new SWIGateway,_dashboard=new SWIDashboard,(_main=new SWIMain).Process(),$(window).scroll(function(){SWIUtil.HideMessages()})});var _da,_daEditor,hasEditor,SWIMain=function(){function e(){this._connected=!1,this._profile=null,this._canEdit=!1,this._folder=null,this._searchMode=!1,this._clipboardCut=!1,this._folderpath="\\"}return e.prototype.Process=function(){$waitDialog=$("#wait-dialog"),$editDialog=$("#edit-dialog"),$folderTree=$("#folder-tree"),$loginModal=$("#login-modal"),$outputPanel=$("#output-panel"),$propertiesPanel=$("#properties-panel"),$elementDropDown=$("#element-dropdown"),$(".navbar-right").hide(),$waitDialog.modal("show"),$("#search-pattern").keypress(function(e){13==(e.keyCode||e.which)&&_main.search()}),$("#password,#username").keypress(function(e){13==(e.keyCode||e.which)&&_main.login()}),$("#login-modal-submit").unbind("click").on("click",function(e){_main.login()}),_gateway.GetVersions(function(e){$("#brand-id").attr("title",SWIUtil.tr2("Web Interface Version")+" : "+e.SWIVersion+"\n"+SWIUtil.tr("Server Version")+" : "+e.SRVersion+"\n"+e.Info),$("#footer-version").text(e.SWIVersion)}),_gateway.GetUserProfile(function(e){e.autenticated?_main.loginSuccess(e):_gateway.Login("","",function(e){_main.loginSuccess(e)},function(e){_main.loginFailure(e,!0)})}),$(window).on("resize",function(){_main.resize()})},e.prototype.loginSuccess=function(e){_main._connected=!0,_main._profile=e,_main._folder=null,_main._searchMode=!1,_main._clipboard=null,_main._clipboardCut=!1,_main.clearFilesTable(),$("#search-pattern").val(""),$("body").children(".modal-backdrop").remove(),$loginModal.modal("hide"),SWIUtil.HideMessages(),$(".navbar-right").show(),$("#footer-div").hide(),$("#password").val(""),$("#login-modal-error").text(""),$("#main-container").css("display","block"),$("#refresh-nav-item").unbind("click").on("click",function(e){"block"!=$("#main-dashboard").css("display")?(_main.ReloadReportsTable(),SWIUtil.IsMobile()&&$(".navbar-toggle").click()):_dashboard&&(_dashboard=new SWIDashboard).init()});var t=0==_main._profile.viewtype||2==_main._profile.viewtype,a=1==_main._profile.viewtype||2==_main._profile.viewtype;SWIUtil.ShowHideControl($("#dashboard-toggle"),2==_main._profile.viewtype),SWIUtil.ShowHideControl($("#dashboards-nav-item"),_main._profile.managedashboards),$("#dashboard-toggle").unbind("click").on("click",function(e){$outputPanel.hide(),_main.showDashboard("block"!=$("#main-dashboard").css("display")),"block"==$("#main-dashboard").css("display")&&(redrawNVD3Charts(),redrawDataTables())}),t&&_main.loadFolderTree(),a&&setTimeout(function(){_dashboard.init()},500),_editor&&_editor.brand(),"dashboards"==_main._profile.lastview?_main.showDashboard(!0):_main.showDashboard(!1),$("#folders-nav-item").unbind("click").on("click",function(e){$outputPanel.hide(),$("#create-folder-name").val(""),$("#rename-folder-name").val(_main._folder.name),SWIUtil.ShowHideControl($("#folder-rename").parent(),2==_main._folder.manage),SWIUtil.ShowHideControl($("#folder-delete").parent(),_main._folder.isEmpty&&2==_main._folder.manage),$("#folder-create").unbind("click").on("click",function(e){$("#folder-dialog").modal("hide");var t=_main._folder.path+(_main._folder.path==dirSeparator?"":dirSeparator)+$("#create-folder-name").val();_gateway.CreateFolder(t,function(e){_main._profile.folder=t,_main.loadFolderTree(),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The folder has been created"),5e3)})}),$("#folder-rename").unbind("click").on("click",function(e){$("#folder-dialog").modal("hide");var t=SWIUtil.GetDirectoryName(_main._folder.path)+dirSeparator+$("#rename-folder-name").val();_gateway.RenameFolder(_main._folder.path,t,function(e){_main._profile.folder=t,_main.loadFolderTree(),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The folder has been renamed"),5e3)})}),$("#folder-delete").unbind("click").on("click",function(e){$("#folder-dialog").modal("hide"),_gateway.DeleteFolder(_main._folder.path,function(e){_main._profile.folder=SWIUtil.GetDirectoryName(_main._folder.path),_main.loadFolderTree(),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The folder has been deleted"),5e3)})}),$("#folder-dialog").modal()}),$("#search-nav-item").unbind("click").on("click",function(e){$outputPanel.hide(),_main.search()}),$("#profile-nav-item").unbind("click").on("click",function(e){if($outputPanel.hide(),$("#profile-user").val(_main._profile.name),$("#profile-groups").val(_main._profile.group),SWIUtil.ShowHideControl($("#view-select-group"),2==_main._profile.viewtype),2==_main._profile.viewtype){var t=$("#view-select");t.unbind("change").selectpicker("destroy").empty(),t.append(SWIUtil.GetOption("reports",SWIUtil.tr("Reports"),_main._profile.lastview,"glyphicon glyphicon-th-list")),t.append(SWIUtil.GetOption("dashboards",SWIUtil.tr("Dashboards"),_main._profile.lastview,"glyphicon glyphicon-th-large")),t.selectpicker("refresh")}$("#profile-save").unbind("click").on("click",function(e){$("#profile-dialog").modal("hide"),_gateway.SetUserProfile($("#culture-select").val(),$("#view-select").val(),function(e){location.reload(!0)})});var a=$("#culture-select");0==a.children("option").length?_gateway.GetCultures(function(e){for(var t=0;t<e.length;t++)a.append(SWIUtil.GetOption(e[t].id,e[t].val,_main._profile.culture));a.selectpicker("refresh"),$("#profile-dialog").modal(),SWIUtil.IsMobile()&&$(".navbar-toggle").click()}):(a.val(_main._profile.culture).change(),a.selectpicker("refresh"),$("#profile-dialog").modal(),SWIUtil.IsMobile()&&$(".navbar-toggle").click())}),$("#disconnect-nav-item").unbind("click").on("click",function(e){SWIUtil.HideMessages(),$outputPanel.hide(),_gateway.Logout(function(e){_main._connected=!1,$("#main-container").css("display","none"),_main.showLogin(),SWIUtil.IsMobile()&&$(".navbar-toggle").click()})}),$("#report-delete-lightbutton").unbind("click").on("click",function(e){if(SWIUtil.IsEnabled($(this))){$outputPanel.hide();var t=$(".report-checkbox:checked").length;$("#message-title").html(SWIUtil.tr("Warning")),$("#message-text").html(SWIUtil.tr("Do you really want to delete the reports or files selected ?")),$("#message-cancel-button").html(SWIUtil.tr("Cancel")),$("#message-ok-button").html(SWIUtil.tr("OK")),$("#message-ok-button").unbind("click").on("click",function(e){$("#message-dialog").modal("hide"),$waitDialog.modal();var a="";$(".report-checkbox:checked").each(function(e,t){a+=$(t).data("path")+"\n"}),_gateway.DeleteFiles(a,function(e){SWIUtil.ShowMessage("alert-success",t+" "+SWIUtil.tr("report(s) or file(s) have been deleted"),5e3),_main.ReloadReportsTable(),$waitDialog.modal("hide")})}),$("#message-dialog").modal()}}),$("#report-rename-lightbutton").unbind("click").on("click",function(e){if(SWIUtil.IsEnabled($(this))){$outputPanel.hide();var o=$(".report-checkbox:checked").first().data("path");if(o){var t=o.split(dirSeparator).pop(),i=t.split(".").pop();$("#report-name-save").unbind("click").on("click",function(e){$waitDialog.modal();var t=_main._folder.path,a=(t!=dirSeparator?t:"")+dirSeparator+$("#report-name").val()+"."+i;$("#report-name-dialog").modal("hide"),_gateway.MoveFile(o,a,!1,function(e){_main.ReloadReportsTable(),$waitDialog.modal("hide"),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The report or file has been renamed"),5e3)})}),$("#report-name").val(t.replace(/\.[^/.]+$/,"")),$("#report-name-dialog").modal()}}}),$("#report-copy-lightbutton").unbind("click").on("click",function(e){SWIUtil.IsEnabled($(this))&&($outputPanel.hide(),_main._clipboard=[],$(".report-checkbox:checked").each(function(e,t){_main._clipboard[e]=$(t).data("path")}),_main._clipboardCut=!1,_main.enableControls(),SWIUtil.ShowMessage("alert-success",_main._clipboard.length.toString()+" "+SWIUtil.tr("report(s) or files(s) copied in the clipboard"),5e3))}),$("#report-cut-lightbutton").unbind("click").on("click",function(e){SWIUtil.IsEnabled($(this))&&($outputPanel.hide(),_main._clipboard=[],$(".report-checkbox:checked").each(function(e,t){_main._clipboard[e]=$(t).data("path")}),_main._clipboardCut=!0,_main.enableControls(),SWIUtil.ShowMessage("alert-success",_main._clipboard.length.toString()+" "+SWIUtil.tr("report(s) or file(s) cut in the clipboard"),5e3))}),$("#report-paste-lightbutton").unbind("click").on("click",function(e){SWIUtil.IsEnabled($(this))&&($outputPanel.hide(),_main._clipboard&&0<_main._clipboard.length&&($waitDialog.modal(),_main._clipboard.forEach(function(e,t){var a=e.split(dirSeparator).pop(),o=_main._folder.path,i=(o!=dirSeparator?o:"")+dirSeparator+a;_gateway.MoveFile(e,i,!_main._clipboardCut,function(e){t==_main._clipboard.length-1&&setTimeout(function(){_main.ReloadReportsTable(),$waitDialog.modal("hide"),SWIUtil.ShowMessage("alert-success",_main._clipboard.length.toString()+" "+SWIUtil.tr("report(s) or file(s) processed"),5e3)},2e3)})})))}),_main.enableControls(),_main.resize()},e.prototype.search=function(){$waitDialog.modal(),_gateway.Search(_main._folder.path,$("#search-pattern").val(),function(e){_main._searchMode=!0,_main.buildReportsTable(e),$waitDialog.modal("hide"),SWIUtil.IsMobile()&&$(".navbar-toggle").click()})},e.prototype.loginFailure=function(e,t){$waitDialog.modal("hide"),_main._connected=!1,t||$("#login-modal-error").text(e.error),_main.showLogin(),_main.enableControls()},e.prototype.showLogin=function(){$("body").children(".modal-backdrop").remove(),$("#footer-div").show(),$loginModal.modal()},e.prototype.login=function(){$loginModal.modal("hide"),$waitDialog.modal(),_gateway.Login($("#username").val(),$("#password").val(),function(e){_main.loginSuccess(e)},function(e){_main.loginFailure(e,!1)})},e.prototype.resize=function(){SWIUtil.IsMobile()?$("#folder-tree").css("max-height",$(window).height()/2-45):($("#folder-tree").height($(window).height()-80),$("#file-table-view").height($(window).height()-125))},e.prototype.enableControls=function(){var e=0,t=!1;_main._folder&&(e=_main._folder.right,t=_main._folder.files),$outputPanel.hide(),SWIUtil.EnableButton($("#report-edit-lightbutton"),e>=folderRightEdit&&!t),SWIUtil.ShowHideControl($("#report-edit-lightbutton"),hasEditor);var a=$(".report-checkbox:checked").length;SWIUtil.EnableButton($("#report-rename-lightbutton"),1==a&&e>=folderRightEdit),SWIUtil.EnableButton($("#report-delete-lightbutton"),0!=a&&e>=folderRightEdit),SWIUtil.EnableButton($("#report-cut-lightbutton"),0!=a&&e>=folderRightEdit),SWIUtil.EnableButton($("#report-copy-lightbutton"),0!=a&&0<e),SWIUtil.EnableButton($("#report-paste-lightbutton"),null!=this._clipboard&&0<this._clipboard.length&&e>=folderRightEdit),SWIUtil.ShowHideControl($("#folders-nav-item"),!!_main._folder&&0<_main._folder.manage),SWIUtil.ShowHideControl($("#file-menu"),_main._canEdit),$("#search-pattern").css("background",_main._searchMode?"orange":"white")},e.prototype.toJSTreeFolderData=function(e,t,a){for(var o=0;o<e.length;o++){var i=e[o];t[t.length]={id:i.path,parent:a,text:""==i.name?"Reports":i.name,state:{opened:i.expand,selected:""==i.name}},i.folders&&0<i.folders.length&&_main.toJSTreeFolderData(i.folders,t,i.path),4==i.right&&(_main._canEdit=!0)}return t},e.prototype.loadFolderTree=function(){_gateway.GetRootFolders(function(e){_main._canEdit=!1;$folderTree.jstree("destroy").empty(),$folderTree.jstree({core:{animation:0,themes:{responsive:!0,stripes:!0},data:_main.toJSTreeFolderData(e,[],"#")},types:{default:{icon:"fa fa-folder-o"}},plugins:["types","wholerow"]}),$folderTree.on("changed.jstree",function(e,t){_main.ReloadReportsTable()}),setTimeout(function(){_main._profile.folder&&""!=_main._profile.folder&&$folderTree.jstree(!0).get_node(_main._profile.folder)||(_main._profile.folder=""),_main._folderpath=_main._profile.folder,$folderTree.jstree("deselect_all"),_main._folderpath&&$folderTree.jstree("select_node",_main._folderpath)},100),$waitDialog.modal("hide")})},e.prototype.ReloadReportsTable=function(){_main.LoadReports($folderTree.jstree("get_selected")[0])},e.prototype.LoadReports=function(t){t&&($("#refresh-nav-item").addClass("fa-spin"),_gateway.GetFolderDetail(t,function(e){_main._searchMode=!1,_main._folder=e.folder,_main._folder.isEmpty=0==e.files.length&&0==$folderTree.jstree("get_selected",!0)[0].children.length,_main.buildReportsTable(e),_main._profile.folder=t,$("#refresh-nav-item").removeClass("fa-spin")}))},e.prototype.clearFilesTable=function(){var e=$("#file-table-head"),t=$("#file-table-body");$("#file-table-head").is(":empty")||$("#file-table").dataTable().fnDestroy(),e.empty(),t.empty()},e.prototype.buildReportsTable=function(e){var t=$("#file-table-head"),a=$("#file-table-body");_main.clearFilesTable();var o=$("<tr>");t.append(o),_main._canEdit&&o.append($("<th style='width:22px;' class='nosort hidden-xs'><input id='selectall-checkbox' type='checkbox'/></th>")),o.append($("<th>").html(SWIUtil.tr("Report"))),o.append($("<th id='action-tableheader' class='nosort'>").html(SWIUtil.tr("Actions"))),o.append($("<th style='width:170px;min-width:170px;' class='hidden-xs'>").html(SWIUtil.tr("Last modification")));for(var i=0;i<e.files.length;i++){var n=e.files[i];o=$("<tr>"),a.append(o),_main._canEdit&&o.append($("<td class='hidden-xs'>").append($("<input>").addClass("report-checkbox").prop("type","checkbox").data("path",n.path))),o.append($("<td>").append($("<a>").addClass("report-name").data("path",n.path).data("isReport",n.isreport).text(n.name)));var r=$("<td>").css("text-align","center").data("path",n.path);o.append(r),n.isreport&&(r.append($("<button>").prop("type","button").prop("title",SWIUtil.tr("Views and outputs")).addClass("btn btn-default btn-table fa fa-list-ul report-output")),n.right>=folderRightSchedule&&hasEditor&&r.append($("<button>").prop("type","button").prop("title",SWIUtil.tr("Edit report")).addClass("btn btn-default fa fa-pencil report-edit hidden-xs"))),o.append($("<td>").css("text-align","right").addClass("hidden-xs").text(n.last))}if(_main._canEdit){var l=$("#selectall-checkbox");l.prop("checked",!1),l.unbind("click").bind("click",function(){$(".report-checkbox").each(function(e,t){var a=l.is(":checked");$(t).prop("checked",a)}),_main.enableControls()})}$(".report-name").on("click",function(e){$outputPanel.hide(),$(e.currentTarget).data("isReport")?_gateway.ExecuteReport($(e.currentTarget).data("path"),!1,null,null):_gateway.ViewFile($(e.currentTarget).data("path"))}),$(".report-output").on("click",function(e){$outputPanel.hide();var o=$(e.currentTarget),i=$("#output-table-body"),n=o.offset().top-30;i.empty(),i.append($("<tr>").append($("<td colspan=2>").append($("<i>").addClass("fa fa-spinner fa-spin fa-1x fa-fw")).append($("<span>").html(SWIUtil.tr("Please wait")+"...")))),$outputPanel.css({display:"inline",position:"absolute","z-index":"10000",left:o.offset().left-$outputPanel.width(),top:n}).show(),$("#output-panel-close").on("click",function(){$outputPanel.hide()}),_gateway.GetReportDetail(o.parent().data("path"),function(e){i.empty();for(var t=0;t<e.views.length;t++){var a=$("<tr>");i.append(a),a.append($("<td>").append($("<a>").data("viewguid",e.views[t].guid).addClass("output-name").text(e.views[t].displayname))),a.append($("<td>").html(SWIUtil.tr("View")))}for(t=0;t<e.outputs.length;t++){a=$("<tr>");i.append(a),a.append($("<td>").append($("<a>").data("outputguid",e.outputs[t].guid).addClass("output-name").text(e.outputs[t].displayname))),a.append($("<td>").html(SWIUtil.tr("Output")))}n=o.offset().top+40-$outputPanel.height(),$outputPanel.css({top:n,left:o.offset().left-$outputPanel.width(),position:"absolute"}),$(".output-name").on("click",function(e){$outputPanel.hide(),_gateway.ExecuteReport(o.parent().data("path"),!1,$(e.currentTarget).data("viewguid"),$(e.currentTarget).data("outputguid"))})},function(e){SWIUtil.ShowMessage("alert-danger",e.error,0),$outputPanel.hide()})}),$("#file-table-view").scroll(function(){$outputPanel.hide()}),_editor&&_editor.init();var d=SWIUtil.IsMobile();$("#file-table").dataTable({bSort:!0,stateSave:!0,aaSorting:[],bPaginate:!d,sPaginationType:"full_numbers",iDisplayLength:25,bInfo:!d,bFilter:!d,bAutoWidth:!1,responsive:!0,oLanguage:{oPaginate:{sFirst:"|&lt;",sPrevious:"&lt;&lt;",sNext:">>",sLast:">|"},sZeroRecords:SWIUtil.tr("No report"),sLengthMenu:SWIUtil.tr("Show _MENU_ reports"),sInfoPostFix:""},columnDefs:[{targets:"nosort",orderable:!1}]}),$(".report-checkbox").on("click",function(){_main.enableControls()}),$("#file-table").on("page.dt",function(){setTimeout(function(){$(".report-checkbox").on("click",function(){_main.enableControls()})},200)}),_main.enableControls()},e.prototype.showDashboard=function(e){var t=$("#dashboard-toggle").children("span");t.removeClass("glyphicon-th-large"),t.removeClass("glyphicon-th-list"),e?($(".folderview").hide(),$(".dashboardview").show(),SWIUtil.ShowHideControl($(".dashboardvieweditor"),hasEditor&&0!=_main._profile.dashboardfolders.length),t.addClass("glyphicon-th-list"),$("#dashboard-toggle").attr("title",SWIUtil.tr2("View reports")),_dashboard.reorderItems(!0)):($(".folderview").show(),$(".dashboardview").hide(),SWIUtil.ShowHideControl($(".dashboardvieweditor"),!1),t.addClass("glyphicon-th-large"),$("#dashboard-toggle").attr("title",SWIUtil.tr2("View dashboards"))),redrawDataTables()},e}();function loadLayout(e,t){for(var a,o,i=JSON.parse(t),n=e.getItems(),r=n.map(function(e){return e.getElement().getAttribute("id")}),l=[],d=0;d<i.length;d++)a=i[d],-1<(o=r.indexOf(a))&&-1==l.indexOf(n[o])&&l.push(n[o]);i.length==l.length?e.sort(l,{layout:"instant"}):e.layout(!0)}var SWIDashboard=function(){function e(){this._dashboards=[],this._gridOrders=[],this._grids=[],this._gridsById=[],this._refreshTimers=[]}return e.prototype.reorderItems=function(e){_da&&_da._dashboard&&(e&&(_da._gridsById=[]),_da._grids=[],$(".grid"+_da._dashboard.GUID).each(function(e,t){var a=$(this).attr("id"),o=_da._gridsById[a];o||(o=new Muuri("#"+a,{dragEnabled:hasEditor&&_da._dashboard.Editable,layoutOnInit:!0,layoutDuration:600,dragStartPredicate:{distance:10,delay:80},dragSort:function(){return hasEditor?_da._grids:[]}}),_da._gridsById[a]=o,hasEditor&&_da._dashboard.Editable&&_daEditor.initGridItemOrder(o)),_da._grids.push(o);var i=_da._gridOrders[a];i?loadLayout(o,i):o.layout(!0)}))},e.prototype.enableControls=function(){var e=$("#dashboard-add-widget"),t=!$(".spinner-menu").is(":visible");SWIUtil.ShowHideControl(e,hasEditor&&_da._dashboard&&_da._dashboard.Editable),SWIUtil.EnableButton(e,hasEditor&&_da._dashboard&&_da._dashboard.Editable&&t),SWIUtil.EnableButton($("#dashboards-nav-item"),t)},e.prototype.handleDashboardResult=function(e){var t=$("#"+e.itemguid),a=t.children(".panel-heading"),o=a.find("a");o.attr("title",e.description),e.path?(o.attr("path",e.path),o.attr("viewGUID",e.viewGUID),o.unbind("click").on("click",function(e){_gateway.ExecuteReport($(e.currentTarget).attr("path"),!1,$(e.currentTarget).attr("viewGUID"),null)})):(o.css("cursor","default"),o.css("text-decoration","none"));var i=t.children(".panel-body");if(i.empty(),i.html(e.content),e.dynamic){var n=$(e.content).find("#new-widget-icon").val();if(n){var r=a.children(".glyphicon");r.removeClass(),r.addClass(n)}var l=$(e.content).find("#new-widget-color").val();l&&(t.removeClass(),t.addClass("item panel panel-"+l));var d=$(e.content).find("#new-widget-name").val();d&&a.find("a").text(" "+d)}a.children(".fa-spinner").hide(),$("#rb"+e.itemguid).attr("title",e.lastexec),0<e.refresh&&(_da._refreshTimers[e.itemguid]=setTimeout(function(){_da.refreshDashboardItem(e.dashboardguid,e.itemguid,!1)},1e3*e.refresh));for(var s=0;s<_da._grids.length;s++)_da._grids[s].refreshItems().layout();initNavCells(e.executionguid,"#"+e.itemguid)},e.prototype.refreshDashboardItem=function(e,t,a){clearTimeout(_da._refreshTimers[t]),_gateway.GetDashboardResult(e,t,a,function(e){_da.handleDashboardResult(e)})},e.prototype.initDashboardItems=function(g){var v=_da._dashboards[g];v&&($("[did='"+g+"']").children(".spinner-menu").show(),SWIUtil.ShowHideControl($("#dashboard-add-widget"),!1),SWIUtil.EnableButton($("#dashboards-nav-item"),!1),$(".grid"+g).each(function(e,t){var a=$(this).attr("id");_da._gridOrders[a]=null,_da._gridsById[a]=null}),_gateway.GetDashboardItems(g,function(e){var t=$("#"+g);t.empty(),$("[did='"+g+"']").children(".spinner-menu").hide(),_da.enableControls();for(var a="",o=null,i=0;i<e.length;i++){var n=e[i];if(a!=n.GroupName||!o){if(t.append($("<hr class='group-name' style='margin:5px 2px'>")),(o=$("<div class='grid grid"+v.GUID+"'>")).attr("id","g"+v.GUID+"-"+n.GroupOrder),o.attr("group-name",n.GroupName),o.attr("group-order",n.GroupOrder),_da._gridsById[o.attr("id")]=null,hasEditor&&_da._dashboards[g].Editable&&_daEditor.initGrid(o),""!=n.GroupName){var r=$("<span for='gn"+n.GUID+"'>").text(n.DisplayGroupName).attr("group-name",n.GroupName).addClass("group-name"),l=$("<input type='text' id='gn"+n.GUID+"' style='width:250px;' hidden>"),d=$("<h4 style='margin:0px 5px'>").append(r);d.attr("group-order",n.GroupOrder),t.append(d),t.append(l),hasEditor&&_da._dashboards[g].Editable&&_daEditor.initGridGroupName(r,l,d)}t.append(o),a=n.GroupName}var s=$("<div class='item panel panel-"+n.Color+"'>");s.attr("id",n.GUID),s.attr("did",v.GUID);var c=$("<div class='panel-heading text-left' style='padding-right:2px;'>");s.append(c),c.append($("<span class='glyphicon glyphicon-"+n.Icon+"'>")),n.DisplayName||(n.DisplayName="");var p=$("<a>)").text(" "+n.DisplayName),u=$("<h3 class='panel-title' style='display:inline'>").append(p);c.append(u),c.append($("<i class='fa fa-spinner fa-spin fa-sm fa-fw'></i>"));var f=$("<button class='btn btn-sm btn-info' type='button' style='margin-left:2px;margin-right:0px;padding:0px 6px;'><span class='glyphicon glyphicon-refresh'></span></button>"),h=$("<div style='display:none;float:right;white-space:nowrap;'>");if(f.attr("id","rb"+n.GUID),h.append(f),hasEditor&&v.Editable)for(var _=_daEditor.getEditButtons(),m=0;m<_.length;m++)h.append(_[m]);c.append(h);var b=$("<div class='panel-body'>");s.append(b),b.append($("<i class='fa fa-spinner fa-spin fa-2x fa-fw'></i>")),b.append($("<h4 style='display:inline'></h4>").html(SWIUtil.tr("Processing")+"...")),_da.refreshDashboardItem(g,n.GUID,!1),0<n.Width&&s.width(n.Width),0<n.Height&&s.height(n.Height),s.css("overflow","auto"),c.mouseenter(function(e){if(!$(this).closest(".panel-heading").children(".fa-spinner").is(":visible")){var t=getTopLeft($(this)[0]),a=$(this).children("div");a.css("position","absolute"),a.css("left",t[0]+$(this).width()-Math.max(a.width(),a.height())+15),a.css("top",t[1]+10),a.show()}}).mouseleave(function(){$(this).children("div").hide()}),f.unbind("click").on("click",function(e){SWIUtil.HideMessages();var t=$(this).closest(".panel").attr("did"),a=$(this).closest(".panel").attr("id");$(this).closest(".panel-heading").children(".fa-spinner").show(),_da.refreshDashboardItem(t,a,!0)}),o.append(s)}_da._dashboard&&g==_da._dashboard.GUID&&_da.reorderItems(!1)}))},e.prototype.init=function(){(_da=this)._dashboard=null,_da._lastGUID||(_da._lastGUID=_main._profile.dashboard),_daEditor&&_daEditor.init(),_gateway.GetUserDashboards(function(e){_da._dashboards=[],$("#menu-dashboard").empty(),$("#content-dashboard").empty();for(var t=0;t<e.length;t++){var a=e[t];_da._dashboards[a.GUID]=a}_da._dashboard=_da._dashboards[_da._lastGUID],!_da._dashboard&&0<e.length&&(_da._lastGUID=e[0].GUID,_da._dashboard=e[0]);for(t=0;t<e.length;t++){a=e[t];var o=$("<a data-toggle='pill' href='#"+a.GUID+"' did='"+a.GUID+"'>");a.IsPersonal&&o.addClass("dashboard-personal"),o.text(a.DisplayName),o.attr("title",a.FullName);var i=$("<li>");_main._profile.manageDashboards&&(i.on("dragstart",function(e){_da._lastGUID=$(this).children("a").attr("did"),_da._dragType="menu"}),i.prop("draggable","true"),i.on("dragover",function(e){"menu"==_da._dragType&&e.preventDefault()}),i.on("drop",function(e){_da._dragType="";_da._dashboard.GUID;var t=$(this).children("a").attr("did");_gateway.SwapDashboardOrder(_da._lastGUID,t,function(e){_da.init()})})),o.append($("<i class='fa fa-spinner fa-spin fa-1x fa-fw spinner-menu'></i>"));var n=a.GUID==_da._lastGUID;n&&i.addClass("active"),$("#menu-dashboard").append(i.append(o)),o.unbind("click").click(function(e){var t=$(this).attr("did");_da._lastGUID=t,_da._dashboard=_da._dashboards[t],_da.enableControls(),_gateway.SetLastDashboard(_da._lastGUID,null),_main._profile.dashboard=_da._lastGUID,SWIUtil.ShowHideControl($(".item,.group-name"),!1),setTimeout(function(){SWIUtil.ShowHideControl($(".item,.group-name"),!0),redrawNVD3Charts(),redrawDataTables(),_da.reorderItems(!0)},400)});var r=$("<div id='"+a.GUID+"' class='tab-pane fade'>");$("#content-dashboard").append(r),n&&r.addClass("in active")}_da._lastGUID&&_da.initDashboardItems(_da._lastGUID);for(t=0;t<e.length;t++)_da._lastGUID&&e[t].GUID==_da._lastGUID||_da.initDashboardItems(e[t].GUID);$("#dashboards-nav-item").unbind("click").on("click",function(e){SWIUtil.HideMessages(),_gateway.GetDashboards(function(e){var t=$("#dashboard-user");t.unbind("change").selectpicker("destroy").empty();for(var a=0;a<e.length;a++){var o=e[a];t.append(SWIUtil.GetOption(o.GUID,o.FullName,""))}t.selectpicker({liveSearch:!0}),SWIUtil.ShowHideControl($("#dashboard-add").parent(),0<e.length),$("#dashboard-add").unbind("click").on("click",function(e){$("#dashboard-user").val()&&($("#dashboard-dialog").modal("hide"),_gateway.AddDashboard($("#dashboard-user").val(),function(e){_da._lastGUID=null,_da.init(),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The dashboards have been added to your view"),5e3)}))}),SWIUtil.ShowHideControl($("#dashboard-remove").parent(),_da._dashboard),_da._dashboard&&$("#dashboard-remove").text("'"+_da._dashboard.FullName+"' : "+SWIUtil.tr("Remove the dashboard from your view")).unbind("click").on("click",function(e){$("#dashboard-dialog").modal("hide"),_gateway.RemoveDashboard(_da._dashboard.GUID,function(e){_da._lastGUID=null,_da.init(),SWIUtil.ShowMessage("alert-success",SWIUtil.tr("The dashboard has been removed from your view"),5e3)})}),hasEditor&&_daEditor.initDashboardMenu(),$("#dashboard-dialog").modal()})}),hasEditor&&_daEditor.initMenu(),_da.enableControls()}),_da.enableControls()},e}();